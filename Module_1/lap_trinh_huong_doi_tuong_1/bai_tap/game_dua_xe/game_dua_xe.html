<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Racing</title>
</head>
<body>
    <img src="car1.png" id="car1" alt="" style="display: none">
    <img src="car2.png" id="car2" alt="" style="display: none">
    <img src="car3.png" id="car3" alt="" style="display: none">
    <img src="car4.png" id="car4" alt="" style="display: none">
    <img src="car5.png" id="car5" alt="" style="display: none">
    <img src="car_main.png" id="carMain" alt="" style="display: none; width: 70px">
    <canvas id="myCanvas" width="335px" style="border: 1px solid black; left: 40%;; position: absolute"></canvas>
    <script>
        window.addEventListener("keypress", ev => {
            getKeyboard(ev);
        });
        document.getElementById("myCanvas").height = screen.height-90;
        let countLine=0, getKeyCode=0, posCarMain = 5;
        class createLine{
            constructor(x, y) {
                this.x = x;
                this.y = y;
            }
            setPosX(x){
                this.x=x;
            }
            setPosY(y){
                this.y=y;
            }
            getPosX(){
                return this.x;
            }
            getPosY(){
                return this.y;
            }
            getDrawX(){
                return 5;
            }
            getDrawY(){
                return 40;
            }
        }
        class createCar extends createLine{
            constructor(x, y, idImage) {
                super(x,y);
                this.idImage = idImage;
            }
            getImage(){
                return document.getElementById("car" + (this.idImage));
            }
        }
        let line1 = new createLine(0, 0);
        let carArray = [], areaPosX = [5, 90, 175, 260];
        for (let i=0; i<5; i++){
            carArray[i] = new createCar(0,0, (i+1));
        }
        let timerDrawLine = setInterval(function () {
            drawLine();
        }, 1);
        drawRandomCar();
        function drawLine() {
            let carMainImage = document.getElementById("carMain");
            let canvas = document.getElementById("myCanvas").getContext("2d");
            canvas.beginPath();
            canvas.fillStyle = "#FF0000";
            for (let i = countLine; i <= 700; i+=50) {
                for (let j=80; j<=250; j+=85){
                    line1.setPosX(j);
                    line1.setPosY(i);
                    if (countLine<10) {
                        canvas.fillRect(line1.getPosX(), line1.getPosY(), line1.getDrawX(), line1.getDrawY());
                        canvas.clearRect(line1.getPosX(), line1.getPosY(), 5, 1);
                    }
                    else {
                        canvas.fillRect(line1.getPosX(), line1.getPosY()-11, line1.getDrawX(), 1);
                        canvas.fillRect(line1.getPosX(), line1.getPosY(), line1.getDrawX(), line1.getDrawY());
                        canvas.clearRect(line1.getPosX(), line1.getPosY(), 5, 1);
                    }
                }
            }
            canvas.stroke();
            if (getKeyCode===100) {
                canvas.clearRect(posCarMain, 575, 70, 100);
                posCarMain+=85;
                if (posCarMain>260) posCarMain=260;
                getKeyCode=0;
            }
            else if (getKeyCode===97){
                canvas.clearRect(posCarMain, 575, 70, 100);
                posCarMain-=85;
                if (posCarMain<5) posCarMain=5;
                getKeyCode=0;
            }
            canvas.drawImage(carMainImage, posCarMain, 575, 70, 100);
            countLine++;
            if(countLine>50) {
                countLine=0;
            }
        }
        function getKeyboard(event) {
            getKeyCode = event.keyCode;
        }
        function drawRandomCar() {
            let canvas = document.getElementById("myCanvas").getContext("2d");
            let randomFor = Math.floor(Math.random() * 4);
            for (let i=randomFor; i<4; i++){
                let randomCreateCar = Math.floor(Math.random() * 5);
                let createPosX = Math.floor(Math.random() * 4);
                carArray[randomCreateCar].setPosX(areaPosX[createPosX]);
                carArray[randomCreateCar].setPosY(0);
                canvas.drawImage(carArray[randomCreateCar].getImage(), carArray[randomCreateCar].getPosX(), carArray[randomCreateCar].getPosY(), 70, 100);
            }
        }
    </script>
</body>
</html>